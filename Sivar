-- Rayfield UI ë¡œë“œ
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- ì°½ ìƒì„±
local Window = Rayfield:CreateWindow({
    Name = "ğŸ¯ Z-Warp AntiGrab",
    LoadingTitle = "ì•ˆí‹°ê·¸ë© + Zì í”„",
    LoadingSubtitle = "5ì´ˆ ìë™ ì í”„ ì‹œìŠ¤í…œ",
    ConfigurationSaving = { Enabled = false },
    KeySystem = false,
    ToggleUIKeybind = "K"
})

-- íƒ­ ìƒì„±
local MainTab = Window:CreateTab("ë©”ì¸", "home")
local AntiGrabTab = Window:CreateTab("ì•ˆí‹°ê·¸ë©", "shield")
local TeleportTab = Window:CreateTab("ìˆœê°„ì´ë™", "arrow")

-------------------------------------------------------------
-- [ì „ì—­ ë³€ìˆ˜]
-------------------------------------------------------------
local player = game.Players.LocalPlayer
local mouse = player:GetMouse()
local userInputService = game:GetService("UserInputService")
local runService = game:GetService("RunService")

-- ìƒíƒœ ë³€ìˆ˜
local isGrabbed = false
local isPaused = false
local grabTimer = 0
local antiGrabEnabled = false
local zTeleportEnabled = true

-------------------------------------------------------------
-- [1] ì•ˆí‹°ê·¸ë© - ì¡í˜ ê°ì§€ ë° 5ì´ˆ ì í”„ ì‹œìŠ¤í…œ
-------------------------------------------------------------
local AntiGrabSection = AntiGrabTab:CreateSection("ğŸ›¡ï¸ 5ì´ˆ ìë™ ì í”„ ì‹œìŠ¤í…œ")

-- ì¡í˜ ê°ì§€ í•¨ìˆ˜
local function checkIfGrabbed()
    if not antiGrabEnabled or isPaused then return false end
    if not player.Character then return false end
    
    local character = player.Character
    
    -- Constraint(ë¡œí”„, ìŠ¤í”„ë§) ê°ì§€
    for _, constraint in ipairs(character:GetDescendants()) do
        if constraint:IsA("Constraint") then
            -- ë‹¤ë¥¸ í”Œë ˆì´ì–´ì™€ ì—°ê²°ëœ Constraint í™•ì¸
            if constraint:IsA("RopeConstraint") or constraint:IsA("SpringConstraint") or constraint:IsA("RodConstraint") then
                local attachments = {constraint.Attachment0, constraint.Attachment1}
                
                for _, att in ipairs(attachments) do
                    if att and att.Parent then
                        local parentPart = att.Parent
                        if parentPart.Parent and parentPart.Parent:IsA("Model") then
                            local char = parentPart.Parent
                            if char:FindFirstChild("Humanoid") then
                                local otherPlayer = game.Players:GetPlayerFromCharacter(char)
                                if otherPlayer and otherPlayer ~= player then
                                    return true, constraint, otherPlayer
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    
    -- Weld/Joint ê°ì§€ (ì¡ê¸°/ë¶™ì¡ê¸°)
    for _, weld in ipairs(character:GetDescendants()) do
        if weld:IsA("Weld") or weld:IsA("Snap") or weld:IsA("Motor6D") then
            if weld.Part0 and weld.Part1 then
                local part0Parent = weld.Part0.Parent
                local part1Parent = weld.Part1.Parent
                
                if part0Parent and part1Parent then
                    if (part0Parent:IsA("Model") and part0Parent:FindFirstChild("Humanoid")) or
                       (part1Parent:IsA("Model") and part1Parent:FindFirstChild("Humanoid")) then
                        
                        local player0 = part0Parent:IsA("Model") and game.Players:GetPlayerFromCharacter(part0Parent)
                        local player1 = part1Parent:IsA("Model") and game.Players:GetPlayerFromCharacter(part1Parent)
                        
                        if (player0 == player and player1 and player1 ~= player) or
                           (player1 == player and player0 and player0 ~= player) then
                            return true, weld, (player0 == player and player1 or player0)
                        end
                    end
                end
            end
        end
    end
    
    -- BodyMover ê°ì§€ (ëŒì–´ë‹¹ê¹€)
    for _, bodyMove in ipairs(character:GetDescendants()) do
        if bodyMove:IsA("BodyPosition") or bodyMove:IsA("BodyVelocity") or bodyMove:IsA("BodyGyro") then
            if bodyMove.Parent ~= character then
                return true, bodyMove
            end
        end
    end
    
    return false
end

-- ì¡í˜ í•´ì œ í•¨ìˆ˜
local function releaseFromGrab()
    if not player.Character then return end
    
    local character = player.Character
    
    -- ëª¨ë“  Constraint ì œê±°
    for _, constraint in ipairs(character:GetDescendants()) do
        if constraint:IsA("Constraint") then
            pcall(function() constraint:Destroy() end)
        end
    end
    
    -- ëª¨ë“  Weld/Joint ì œê±° (ë‹¤ë¥¸ í”Œë ˆì´ì–´ì™€ ì—°ê²°ëœ ê²ƒë§Œ)
    for _, weld in ipairs(character:GetDescendants()) do
        if weld:IsA("Weld") or weld:IsA("Snap") or weld:IsA("Motor6D") then
            if weld.Part0 and weld.Part1 then
                local part0Parent = weld.Part0.Parent
                local part1Parent = weld.Part1.Parent
                
                if part0Parent and part1Parent then
                    if (part0Parent:IsA("Model") and part0Parent:FindFirstChild("Humanoid")) or
                       (part1Parent:IsA("Model") and part1Parent:FindFirstChild("Humanoid")) then
                        pcall(function() weld:Destroy() end)
                    end
                end
            end
        end
    end
    
    -- BodyMover ì œê±°
    for _, bodyMove in ipairs(character:GetDescendants()) do
        if bodyMove:IsA("BodyPosition") or bodyMove:IsA("BodyVelocity") then
            pcall(function() bodyMove:Destroy() end)
        end
    end
end

-- 5ì´ˆ ì í”„ ì‹œìŠ¤í…œ
local function startJumpRelease()
    isGrabbed = true
    grabTimer = 5
    
    Rayfield:Notify({
        Title = "âš ï¸ ì¡í˜ ê°ì§€!",
        Content = "5ì´ˆ í›„ ìë™ ì í”„ë¡œ í•´ì œí•©ë‹ˆë‹¤",
        Duration = 3
    })
    
    -- 5ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ ë° ì í”„
    for i = 5, 1, -1 do
        if not isGrabbed or not antiGrabEnabled then break end
        
        grabTimer = i
        
        -- ë§¤ì´ˆ ì í”„ (í’€ê¸° ì‹œë„)
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            local humanoid = player.Character.Humanoid
            humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            
            -- ì•½ê°„ì˜ í˜ ì¶”ê°€
            local hrp = player.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                hrp.Velocity = hrp.Velocity + Vector3.new(0, 50, 0)
            end
        end
        
        task.wait(1)
    end
    
    -- 5ì´ˆ í›„ì—ë„ ì¡í˜€ìˆìœ¼ë©´ ê°•ì œ í•´ì œ
    if isGrabbed and antiGrabEnabled then
        releaseFromGrab()
        
        Rayfield:Notify({
            Title = "âœ… ê°•ì œ í•´ì œ",
            Content = "5ì´ˆ ì í”„ë¡œ ì¡í˜ ìƒíƒœ í•´ì œë¨",
            Duration = 2
        })
        
        -- í•´ì œ í›„ ëª¨ë“  ê¸°ëŠ¥ ì¼ì‹œì •ì§€
        isPaused = true
        isGrabbed = false
        
        -- 2ì´ˆ í›„ ì¼ì‹œì •ì§€ í•´ì œ
        task.wait(2)
        isPaused = false
        
        Rayfield:Notify({
            Title = "â–¶ï¸ ê¸°ëŠ¥ ì¬ê°œ",
            Content = "ëª¨ë“  ê¸°ëŠ¥ì´ ë‹¤ì‹œ í™œì„±í™”ë©ë‹ˆë‹¤",
            Duration = 2
        })
    end
end

-- ë©”ì¸ ê°ì§€ ë£¨í”„
local function startDetection()
    spawn(function()
        while antiGrabEnabled do
            task.wait(0.5) -- 0.5ì´ˆë§ˆë‹¤ ê°ì§€
            
            if isPaused then continue end
            
            local grabbed, obj, grabber = checkIfGrabbed()
            
            if grabbed and not isGrabbed then
                -- ìƒˆë¡œ ì¡í˜ ê°ì§€
                startJumpRelease()
                
            elseif not grabbed and isGrabbed then
                -- ì¡í˜ í•´ì œë¨
                isGrabbed = false
                
                Rayfield:Notify({
                    Title = "ğŸ”“ ì¡í˜ í•´ì œ",
                    Content = "5ì´ˆ ëŒ€ê¸° í›„ ê¸°ëŠ¥ ì¬ê°œí•©ë‹ˆë‹¤",
                    Duration = 2
                })
                
                -- í•´ì œ ì‹œ ëª¨ë“  ê¸°ëŠ¥ ì¼ì‹œì •ì§€
                isPaused = true
                
                -- 5ì´ˆ ëŒ€ê¸°
                task.wait(5)
                
                isPaused = false
                
                Rayfield:Notify({
                    Title = "â–¶ï¸ ê¸°ëŠ¥ ì¬ê°œ",
                    Content = "ëª¨ë“  ê¸°ëŠ¥ì´ ë‹¤ì‹œ í™œì„±í™”ë©ë‹ˆë‹¤",
                    Duration = 2
                })
            end
        end
    end)
end

-- ì•ˆí‹°ê·¸ë© í† ê¸€
AntiGrabTab:CreateToggle({
    Name = "ğŸ›¡ï¸ ì•ˆí‹°ê·¸ë© í™œì„±í™”",
    CurrentValue = false,
    Callback = function(Value)
        antiGrabEnabled = Value
        
        if Value then
            startDetection()
            Rayfield:Notify({
                Title = "âœ… ì•ˆí‹°ê·¸ë© ON",
                Content = "ì¡í˜ ê°ì§€ ë° 5ì´ˆ ì í”„ ì‹œìŠ¤í…œ ì‘ë™",
                Duration = 3
            })
        else
            isGrabbed = false
            isPaused = false
            Rayfield:Notify({
                Title = "â›” ì•ˆí‹°ê·¸ë© OFF",
                Content = "ë³´í˜¸ ê¸°ëŠ¥ ë¹„í™œì„±í™”",
                Duration = 2
            })
        end
    end
})

-- ìˆ˜ë™ í•´ì œ ë²„íŠ¼
AntiGrabTab:CreateButton({
    Name = "ğŸ”“ ì§€ê¸ˆ ì¦‰ì‹œ í•´ì œ",
    Callback = function()
        releaseFromGrab()
        isGrabbed = false
        isPaused = true
        
        Rayfield:Notify({
            Title = "âœ… ìˆ˜ë™ í•´ì œ",
            Content = "5ì´ˆ í›„ ê¸°ëŠ¥ ì¬ê°œ",
            Duration = 2
        })
        
        task.wait(5)
        isPaused = false
    end
})

-- í˜„ì¬ ìƒíƒœ í‘œì‹œ
AntiGrabTab:CreateParagraph({
    Title = "ìƒíƒœ ì •ë³´",
    Content = "ì¡í˜ ìƒíƒœ: ëŒ€ê¸°ì¤‘\nì¼ì‹œì •ì§€: êº¼ì§"
})

-- ìƒíƒœ ì—…ë°ì´íŠ¸ (ì„ íƒì‚¬í•­)
spawn(function()
    while true do
        task.wait(1)
        if antiGrabEnabled then
            local statusText = string.format(
                "ì¡í˜ ìƒíƒœ: %s\nì¼ì‹œì •ì§€: %s\níƒ€ì´ë¨¸: %dì´ˆ",
                isGrabbed and "âœ… ì¡í˜" or "âŒ ì—†ìŒ",
                isPaused and "â¸ï¸ ì •ì§€" or "â–¶ï¸ ì‘ë™",
                grabTimer
            )
            -- Paragraph ì—…ë°ì´íŠ¸ëŠ” Rayfieldì—ì„œ ì§ì ‘ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
        end
    end
end)

-------------------------------------------------------------
-- [2] Zí‚¤ ìˆœê°„ì´ë™ (ë§ˆìš°ìŠ¤ ìœ„ì¹˜ë¡œ)
-------------------------------------------------------------
local TeleportSection = TeleportTab:CreateSection("ğŸŒ€ Zí‚¤ ìˆœê°„ì´ë™")

-- ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì˜ 3D ì¢Œí‘œ ì–»ê¸°
local function getMouseTarget()
    local unitRay = mouse.UnitRay
    local origin = unitRay.Origin
    local direction = unitRay.Direction * 1000
    
    local params = RaycastParams.new()
    params.FilterType = Enum.RaycastFilterType.Blacklist
    params.FilterDescendantsInstances = {player.Character}
    
    local result = workspace:Raycast(origin, direction, params)
    
    if result then
        return result.Position + result.Normal * 3 -- ì•½ê°„ ì•ìœ¼ë¡œ
    else
        return origin + direction
    end
end

-- Zí‚¤ ì…ë ¥ ì²˜ë¦¬
userInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if not zTeleportEnabled or isPaused then return end
    if not player.Character then return end
    
    if input.KeyCode == Enum.KeyCode.Z then
        -- Zí‚¤ ëˆŒë €ì„ ë•Œ ìˆœê°„ì´ë™
        local targetPos = getMouseTarget()
        local hrp = player.Character:FindFirstChild("HumanoidRootPart")
        
        if hrp then
            hrp.CFrame = CFrame.new(targetPos)
            
            -- íš¨ê³¼ (ì„ íƒì‚¬í•­)
            local highlight = Instance.new("Highlight")
            highlight.Parent = workspace
            highlight.Adornee = player.Character
            highlight.FillColor = Color3.fromRGB(0, 255, 255)
            highlight.FillTransparency = 0.3
            highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
            
            game:GetService("Debris"):AddItem(highlight, 0.5)
        end
    end
end)

-- Zí‚¤ ìˆœê°„ì´ë™ í† ê¸€
TeleportTab:CreateToggle({
    Name = "ğŸŒ€ Zí‚¤ ìˆœê°„ì´ë™",
    CurrentValue = true,
    Callback = function(Value)
        zTeleportEnabled = Value
    end
})

-- ìˆœê°„ì´ë™ í…ŒìŠ¤íŠ¸ ë²„íŠ¼
TeleportTab:CreateButton({
    Name = "ğŸ¯ í˜„ì¬ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ë¡œ ì´ë™",
    Callback = function()
        if isPaused then
            Rayfield:Notify({
                Title = "â›” ì¼ì‹œì •ì§€ ìƒíƒœ",
                Content = "ì•ˆí‹°ê·¸ë© í•´ì œ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤",
                Duration = 2
            })
            return
        end
        
        local targetPos = getMouseTarget()
        local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        
        if hrp then
            hrp.CFrame = CFrame.new(targetPos)
        end
    end
})

-- ê±°ë¦¬ í‘œì‹œ (ì„ íƒì‚¬í•­)
TeleportTab:CreateParagraph({
    Title = "ì‚¬ìš©ë²•",
    Content = "Z í‚¤ë¥¼ ëˆ„ë¥´ë©´ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ë¡œ ìˆœê°„ì´ë™\nì•ˆí‹°ê·¸ë© ì¼ì‹œì •ì§€ ì¤‘ì—ëŠ” ì‚¬ìš© ë¶ˆê°€"
})

-------------------------------------------------------------
-- [3] ë°˜ì§ì´ëŠ” ë¬¼ê±´ ì°¾ê¸°
-------------------------------------------------------------
local ShinySection = MainTab:CreateSection("âœ¨ ë°˜ì§ì´ íƒì§€")

-- ë°˜ì§ì´ íƒì§€ í•¨ìˆ˜
local function findShinyObjects()
    local found = {}
    
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") then
            -- ë°˜ì§ì´ëŠ” ì¬ì§ˆ ì²´í¬
            local shinyMaterials = {
                [Enum.Material.Neon] = true,
                [Enum.Material.DiamondPlate] = true,
                [Enum.Material.Foil] = true,
                [Enum.Material.Glass] = true,
                [Enum.Material.Glacier] = true
            }
            
            if shinyMaterials[obj.Material] or obj.Reflectance > 0.3 then
                table.insert(found, obj)
                
                -- í•˜ì´ë¼ì´íŠ¸
                local highlight = Instance.new("Highlight")
                highlight.Parent = obj
                highlight.Adornee = obj
                highlight.FillColor = Color3.fromRGB(255, 255, 0)
                highlight.FillTransparency = 0.3
                
                game:GetService("Debris"):AddItem(highlight, 3)
            end
        end
    end
    
    return found
end

MainTab:CreateButton({
    Name = "ğŸ” ë°˜ì§ì´ ìŠ¤ìº”",
    Callback = function()
        local results = findShinyObjects()
        Rayfield:Notify({
            Title = "ìŠ¤ìº” ì™„ë£Œ",
            Content = "ë°œê²¬ëœ ë°˜ì§ì´: " .. #results .. "ê°œ",
            Duration = 3
        })
    end
})

-- ì´ˆê¸° ì•Œë¦¼
Rayfield:Notify({
    Title = "ğŸš€ ë¡œë“œ ì™„ë£Œ",
    Content = "Zí‚¤: ìˆœê°„ì´ë™ | ì•ˆí‹°ê·¸ë©: 5ì´ˆ ì í”„",
    Duration = 5
})
