-- ë©”ì¸ ìœˆë„ìš° ìƒì„±
local Window = Rayfield:CreateWindow({
   Name = "ğŸ”« Arsenal | ë°˜ë¬¼ì‚¬ ì˜¬ì¸ì›",
   LoadingTitle = "Arsenal Script",
   LoadingSubtitle = "by Rayfield",
   Theme = "Ocean",
   ToggleUIKeybind = "RightShift", -- UI í† ê¸€ í‚¤
   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false,
})

-- ì„œë¹„ìŠ¤ ë° ë³€ìˆ˜
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- ê¸°ëŠ¥ ìƒíƒœ
local aimbotEnabled = false
local espEnabled = false
local triggerbotEnabled = false
local silentAimEnabled = false
local wallbangEnabled = false
local noRecoilEnabled = false
local teamCheck = true
local fovCircle = true

-- ì„¤ì •ê°’
local aimPart = "Head"
local fovSize = 120
local smoothness = 1
local espColor = Color3.fromRGB(255, 0, 0)

-- FOV ì›
local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = false
FOVCircle.Color = Color3.fromRGB(255, 255, 255)
FOVCircle.Thickness = 1
FOVCircle.NumSides = 64
FOVCircle.Radius = fovSize
FOVCircle.Filled = false
FOVCircle.Transparency = 0.7
FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

-- ESP ì €ì¥ì†Œ
local espObjects = {}

-- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
local function getClosestPlayer()
   local closest = nil
   local shortestDistance = fovSize
   local mousePos = UserInputService:GetMouseLocation()
   
   for _, player in pairs(Players:GetPlayers()) do
      if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
         -- íŒ€ ì²´í¬
         if teamCheck and player.Team == LocalPlayer.Team then
            continue
         end
         
         local head = player.Character:FindFirstChild(aimPart) or player.Character:FindFirstChild("Head")
         if head then
            local headPos, onScreen = Camera:WorldToViewportPoint(head.Position)
            if onScreen then
               local distance = (Vector2.new(headPos.X, headPos.Y) - mousePos).Magnitude
               if distance < shortestDistance then
                  shortestDistance = distance
                  closest = player
               end
            end
         end
      end
   end
   
   return closest
end

-- ESP ìƒì„± í•¨ìˆ˜
local function createESP(player)
   if espObjects[player] then return end
   
   local esp = {
      highlight = Instance.new("Highlight"),
      nameTag = Drawing.new("Text")
   }
   
   esp.highlight.Adornee = player.Character
   esp.highlight.FillColor = espColor
   esp.highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
   esp.highlight.FillTransparency = 0.5
   esp.highlight.Parent = player.Character
   
   esp.nameTag.Size = 16
   esp.nameTag.Center = true
   esp.nameTag.Outline = true
   esp.nameTag.Font = 2
   esp.nameTag.Color = Color3.fromRGB(255, 255, 255)
   
   espObjects[player] = esp
end

-- ESP ì œê±° í•¨ìˆ˜
local function removeESP(player)
   if espObjects[player] then
      espObjects[player].highlight:Destroy()
      espObjects[player].nameTag:Remove()
      espObjects[player] = nil
   end
end

-- íƒ­ ìƒì„±
local MainTab = Window:CreateTab("ğŸ® ë©”ì¸", "home")
local AimbotTab = Window:CreateTab("ğŸ¯ ì—ì„ë´‡", "crosshair")
local VisualTab = Window:CreateTab("ğŸ‘ï¸ ë¹„ì£¼ì–¼", "eye")
local MiscTab = Window:CreateTab("âš™ï¸ ê¸°íƒ€", "settings")

-- ===== ë©”ì¸ íƒ­ =====
MainTab:CreateSection("ì´ë™ ì„¤ì •")

MainTab:CreateSlider({
   Name = "ì´ë™ ì†ë„",
   Range = {16, 120},
   Increment = 1,
   Suffix = "ì†ë„",
   CurrentValue = 16,
   Callback = function(value)
      if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
         LocalPlayer.Character.Humanoid.WalkSpeed = value
      end
   end,
})

MainTab:CreateSlider({
   Name = "ì í”„ë ¥",
   Range = {50, 200},
   Increment = 5,
   Suffix = "íŒŒì›Œ",
   CurrentValue = 50,
   Callback = function(value)
      if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
         LocalPlayer.Character.Humanoid.JumpPower = value
      end
   end,
})

MainTab:CreateToggle({
   Name = "ë¹„í–‰ ëª¨ë“œ",
   CurrentValue = false,
   Callback = function(value)
      local char = LocalPlayer.Character
      if char then
         local humanoid = char:FindFirstChild("Humanoid")
         if humanoid then
            humanoid.PlatformStand = value
            if value then
               game:GetService("UserInputService").JumpRequest:Connect(function()
                  humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
               end)
            end
         end
      end
   end,
})

-- ===== ì—ì„ë´‡ íƒ­ =====
AimbotTab:CreateSection("ì—ì„ë´‡ ì„¤ì •")

AimbotTab:CreateToggle({
   Name = "ì—ì„ë´‡ í™œì„±í™”",
   CurrentValue = false,
   Callback = function(value)
      aimbotEnabled = value
      Rayfield:Notify({
         Title = "ì—ì„ë´‡",
         Content = value and "í™œì„±í™”ë¨ âœ…" or "ë¹„í™œì„±í™”ë¨ âŒ",
         Duration = 2.5,
         Image = "rbxassetid://4483345998"
      })
   end,
})

AimbotTab:CreateToggle({
   Name = "ì‚¬ì¼ëŸ°íŠ¸ ì—ì„",
   CurrentValue = false,
   Callback = function(value)
      silentAimEnabled = value
   end,
})

AimbotTab:CreateToggle({
   Name = "íŠ¸ë¦¬ê±°ë´‡",
   CurrentValue = false,
   Callback = function(value)
      triggerbotEnabled = value
   end,
})

AimbotTab:CreateToggle({
   Name = "íŒ€ í™•ì¸ (ì•„êµ° ì œì™¸)",
   CurrentValue = true,
   Callback = function(value)
      teamCheck = value
   end,
})

AimbotTab:CreateDropdown({
   Name = "ì¡°ì¤€ ë¶€ìœ„",
   Options = {"Head", "Torso", "HumanoidRootPart"},
   CurrentOption = "Head",
   Callback = function(option)
      aimPart = option
   end,
})

AimbotTab:CreateSlider({
   Name = "FOV í¬ê¸°",
   Range = {30, 300},
   Increment = 5,
   Suffix = "px",
   CurrentValue = 120,
   Callback = function(value)
      fovSize = value
      FOVCircle.Radius = value
   end,
})

AimbotTab:CreateToggle({
   Name = "FOV ì› í‘œì‹œ",
   CurrentValue = true,
   Callback = function(value)
      fovCircle = value
      FOVCircle.Visible = value
   end,
})

AimbotTab:CreateSlider({
   Name = "ì—ì„ ìŠ¤ë¬´ë”©",
   Range = {1, 20},
   Increment = 1,
   Suffix = "ê°•ë„",
   CurrentValue = 1,
   Callback = function(value)
      smoothness = value
   end,
})

-- ===== ë¹„ì£¼ì–¼ íƒ­ =====
VisualTab:CreateSection("ESP ì„¤ì •")

VisualTab:CreateToggle({
   Name = "ESP í™œì„±í™”",
   CurrentValue = false,
   Callback = function(value)
      espEnabled = value
      if value then
         for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
               createESP(player)
            end
         end
      else
         for player, _ in pairs(espObjects) do
            removeESP(player)
         end
      end
   end,
})

VisualTab:CreateToggle({
   Name = "ë°•ìŠ¤ ESP",
   CurrentValue = false,
   Callback = function(value)
      -- ë°•ìŠ¤ ESP êµ¬í˜„
   end,
})

VisualTab:CreateToggle({
   Name = "ì´ë¦„ ESP",
   CurrentValue = true,
   Callback = function(value)
      -- ì´ë¦„ ESP êµ¬í˜„
   end,
})

VisualTab:CreateToggle({
   Name = "ê±°ë¦¬ í‘œì‹œ",
   CurrentValue = false,
   Callback = function(value)
      -- ê±°ë¦¬ í‘œì‹œ êµ¬í˜„
   end,
})

VisualTab:CreateColorPicker({
   Name = "ESP ìƒ‰ìƒ",
   Color = Color3.fromRGB(255, 0, 0),
   Callback = function(color)
      espColor = color
      for _, esp in pairs(espObjects) do
         if esp.highlight then
            esp.highlight.FillColor = color
         end
      end
   end,
})

-- ===== ê¸°íƒ€ íƒ­ =====
MiscTab:CreateSection("ì´ê¸° ì„¤ì •")

MiscTab:CreateToggle({
   Name = "ë…¸ë¦¬ì‡  (ë¬´ë°˜ë™)",
   CurrentValue = false,
   Callback = function(value)
      noRecoilEnabled = value
   end,
})

MiscTab:CreateToggle({
   Name = "ì›”ìƒ· (ê´€í†µ)",
   CurrentValue = false,
   Callback = function(value)
      wallbangEnabled = value
   end,
})

MiscTab:CreateSection("ê¸°íƒ€ ê¸°ëŠ¥")

MiscTab:CreateButton({
   Name = "ëª¨ë“  ì´ì•Œ ë¬´í•œ",
   Callback = function()
      local char = LocalPlayer.Character
      if char then
         local tool = char:FindFirstChildWhichIsA("Tool")
         if tool and tool:FindFirstChild("Ammo") then
            tool.Ammo.Value = math.huge
            Rayfield:Notify({
               Title = "ë¬´í•œ íƒ„ì•½",
               Content = "ì ìš© ì™„ë£Œ!",
               Duration = 2
            })
         end
      end
   end,
})

MiscTab:CreateButton({
   Name = "ì¦‰ì‹œ ë¦¬ìŠ¤í°",
   Callback = function()
      local char = LocalPlayer.Character
      if char and char:FindFirstChild("Humanoid") then
         char.Humanoid.Health = 0
      end
   end,
})

MiscTab:CreateButton({
   Name = "ëª¨ë“  ìŠ¤í‚¨ ì ê¸ˆí•´ì œ",
   Callback = function()
      -- ìŠ¤í‚¨ ì–¸ë½ ì½”ë“œ
      Rayfield:Notify({
         Title = "ìŠ¤í‚¨ ì–¸ë½",
         Content = "ì´ ê¸°ëŠ¥ì€ í˜„ì¬ ê°œë°œì¤‘ì…ë‹ˆë‹¤",
         Duration = 3
      })
   end,
})

-- ===== ë£¨í”„ ê¸°ëŠ¥ =====
RunService.RenderStepped:Connect(function()
   -- FOV ì› ìœ„ì¹˜ ì—…ë°ì´íŠ¸
   if fovCircle then
      FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
   end

   -- ì—ì„ë´‡
   if aimbotEnabled then
      local target = getClosestPlayer()
      if target and target.Character then
         local part = target.Character:FindFirstChild(aimPart) or target.Character:FindFirstChild("Head")
         if part then
            local partPos = part.Position
            if smoothness > 1 then
               -- ë¶€ë“œëŸ¬ìš´ ì—ì„
               local currentPos = Camera.CFrame.Position
               local targetCFrame = CFrame.lookAt(currentPos, partPos)
               Camera.CFrame = Camera.CFrame:Lerp(targetCFrame, 0.1 / smoothness)
            else
               -- ì¦‰ì‹œ ì¡°ì¤€
               Camera.CFrame = CFrame.lookAt(Camera.CFrame.Position, partPos)
            end
         end
      end
   end

   -- íŠ¸ë¦¬ê±°ë´‡
   if triggerbotEnabled then
      local mouse = LocalPlayer:GetMouse()
      local target = mouse.Target
      if target and target.Parent then
         local player = Players:GetPlayerFromCharacter(target.Parent)
         if player and player ~= LocalPlayer then
            if not teamCheck or player.Team ~= LocalPlayer.Team then
               mouse1press()
               wait(0.01)
               mouse1release()
            end
         end
      end
   end

   -- ESP ì—…ë°ì´íŠ¸
   if espEnabled then
      for player, esp in pairs(espObjects) do
         if player.Character and player.Character:FindFirstChild("Head") then
            local headPos, onScreen = Camera:WorldToViewportPoint(player.Character.Head.Position)
            if onScreen then
               esp.nameTag.Position = Vector2.new(headPos.X, headPos.Y - 50)
               esp.nameTag.Text = player.Name .. " [" .. math.floor(player.Character.Humanoid.Health) .. "HP]"
               esp.nameTag.Visible = true
               
               -- íŒ€ ìƒ‰ìƒ ì ìš©
               if player.Team == LocalPlayer.Team then
                  esp.nameTag.Color = Color3.fromRGB(0, 255, 0)
               else
                  esp.nameTag.Color = Color3.fromRGB(255, 0, 0)
               end
            else
               esp.nameTag.Visible = false
            end
         else
            esp.nameTag.Visible = false
         end
      end
   end

   -- ë¬´ë°˜ë™
   if noRecoilEnabled and LocalPlayer.Character then
      local tool = LocalPlayer.Character:FindFirstChildWhichIsA("Tool")
      if tool and tool:FindFirstChild("Recoil") then
         tool.Recoil:Destroy()
      end
   end
end)

-- í”Œë ˆì´ì–´ ì¶”ê°€/ì œê±° ì´ë²¤íŠ¸
Players.PlayerAdded:Connect(function(player)
   player.CharacterAdded:Connect(function()
      if espEnabled then
         createESP(player)
      end
   end)
end)

Players.PlayerRemoving:Connect(function(player)
   removeESP(player)
end)

-- UI í† ê¸€ ì•Œë¦¼
Rayfield:Notify({
   Title = "ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ",
   Content = "RightShift í‚¤ë¡œ UIë¥¼ í† ê¸€í•˜ì„¸ìš”",
   Duration = 3,
   Image = "rbxassetid://4483345998"
})
