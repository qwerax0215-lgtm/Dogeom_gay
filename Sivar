-- Rayfield UI ë¡œë“œ
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- ì°½ ìƒì„±
local Window = Rayfield:CreateWindow({
    Name = "ğŸ”’ Anti-Grab Ultimate",
    LoadingTitle = "ì•ˆí‹° ê·¸ë© + í”Œë§ + ë°˜ì§ì´",
    LoadingSubtitle = "ì¢…í•© í•µ ëª¨ìŒ",
    ConfigurationSaving = { Enabled = false },
    KeySystem = false,
    ToggleUIKeybind = "K"
})

-- íƒ­ ìƒì„±
local AntiGrabTab = Window:CreateTab("ì•ˆí‹° ê·¸ë©", "shield")
local ShinyTab = Window:CreateTab("ë°˜ì§ì´ íƒì§€", "star")
local FlingTab = Window:CreateTab("í”Œë§", "hammer")

-------------------------------------------------------------
-- [1] ì•ˆí‹° ê·¸ë© (Anti-Grab) ì½”ì–´ ê¸°ëŠ¥
-------------------------------------------------------------
local AntiGrabSection = AntiGrabTab:CreateSection("ğŸ›¡ï¸ ì•ˆí‹° ê·¸ë© ì„¤ì •")

local antiGrabEnabled = false
local antiGrabMode = "í…”ë ˆí¬íŠ¸" -- "í…”ë ˆí¬íŠ¸", "ë„‰ë°±", "íˆ¬ëª…í™”"
local antiGrabDistance = 10
local lastGrabber = nil
local grabAttempts = 0

-- ì•ˆí‹° ê·¸ë© ê°ì§€ ì‹œìŠ¤í…œ
local function setupAntiGrab()
    local lp = game.Players.LocalPlayer
    if not lp.Character then return end
    
    local hrp = lp.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    -- ì£¼ë³€ í”Œë ˆì´ì–´ ê°ì§€ (ì ‘ê·¼í•˜ëŠ” ì‚¬ëŒ)
    spawn(function()
        while antiGrabEnabled do
            task.wait(0.1)
            
            if not lp.Character or not hrp then
                hrp = lp.Character and lp.Character:FindFirstChild("HumanoidRootPart")
                if not hrp then continue end
            end
            
            local myPos = hrp.Position
            
            for _, player in ipairs(game.Players:GetPlayers()) do
                if player ~= lp and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    local theirHrp = player.Character.HumanoidRootPart
                    local distance = (myPos - theirHrp.Position).Magnitude
                    
                    -- ë„ˆë¬´ ê°€ê¹Œì´ ì˜¤ë©´ ìœ„í˜‘ìœ¼ë¡œ ê°„ì£¼
                    if distance < antiGrabDistance then
                        handleGrabAttempt(player, distance)
                    end
                end
            end
        end
    end)
    
    -- ë°”ì¸ë“œ ê°ì§€ (Constraint ê°ì§€ - ë¡œí”„, ìŠ¤í”„ë§ ë“±)
    spawn(function()
        while antiGrabEnabled do
            task.wait(0.5)
            
            if not lp.Character then continue end
            
            -- ëª¸ì— ì—°ê²°ëœ Constraint í™•ì¸
            for _, constraint in ipairs(lp.Character:GetDescendants()) do
                if constraint:IsA("Constraint") then
                    -- ë‹¤ë¥¸ í”Œë ˆì´ì–´ì™€ ì—°ê²°ëœ Constraint ê°ì§€
                    local attachedToPlayer = false
                    
                    if constraint:IsA("RopeConstraint") or constraint:IsA("SpringConstraint") then
                        local attachments = {constraint.Attachment0, constraint.Attachment1}
                        
                        for _, att in ipairs(attachments) do
                            if att and att.Parent then
                                local parentPart = att.Parent
                                if parentPart.Parent and parentPart.Parent:IsA("Model") then
                                    local character = parentPart.Parent
                                    if character:FindFirstChild("Humanoid") then
                                        local player = game.Players:GetPlayerFromCharacter(character)
                                        if player and player ~= lp then
                                            attachedToPlayer = true
                                            lastGrabber = player
                                            break
                                        end
                                    end
                                end
                            end
                        end
                    end
                    
                    if attachedToPlayer then
                        -- Constraint ì œê±°
                        constraint:Destroy()
                        Rayfield:Notify({
                            Title = "ğŸš« ê·¸ë© ë°©ì§€",
                            Content = "ì¡ê¸° ì‹œë„ ì°¨ë‹¨!",
                            Duration = 2
                        })
                    end
                end
            end
        end
    end)
end

-- ê·¸ë© ì‹œë„ ì²˜ë¦¬
local function handleGrabAttempt(player, distance)
    if not antiGrabEnabled then return end
    
    local lp = game.Players.LocalPlayer
    if not lp.Character then return end
    
    grabAttempts = grabAttempts + 1
    lastGrabber = player
    
    -- ì•Œë¦¼ (3ë²ˆì§¸ ì‹œë„ë§ˆë‹¤)
    if grabAttempts % 3 == 0 then
        Rayfield:Notify({
            Title = "âš ï¸ ê·¸ë© ê°ì§€",
            Content = player.Name .. "ë‹˜ì´ ì ‘ê·¼ ì¤‘!",
            Duration = 2
        })
    end
    
    -- ëª¨ë“œë³„ ëŒ€ì‘
    if antiGrabMode == "í…”ë ˆí¬íŠ¸" then
        -- ì•ˆì „í•œ ìœ„ì¹˜ë¡œ í…”ë ˆí¬íŠ¸
        local hrp = lp.Character.HumanoidRootPart
        hrp.CFrame = hrp.CFrame + Vector3.new(0, 20, 20)
        
    elseif antiGrabMode == "ë„‰ë°±" then
        -- ì ‘ê·¼í•œ í”Œë ˆì´ì–´ ë°€ì³ë‚´ê¸°
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local theirHrp = player.Character.HumanoidRootPart
            local direction = (theirHrp.Position - lp.Character.HumanoidRootPart.Position).Unit
            theirHrp.Velocity = direction * 100 + Vector3.new(0, 50, 0)
        end
        
    elseif antiGrabMode == "íˆ¬ëª…í™”" then
        -- íˆ¬ëª…í™” ë° ì¶©ëŒ ë¹„í™œì„±í™”
        for _, part in ipairs(lp.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.Transparency = 0.8
                part.CanCollide = false
            end
        end
        
        -- 2ì´ˆ í›„ ë³µêµ¬
        task.wait(2)
        for _, part in ipairs(lp.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.Transparency = 0
                part.CanCollide = true
            end
        end
    end
end

-- ì•ˆí‹° ê·¸ë© í† ê¸€
local AntiGrabToggle = AntiGrabTab:CreateToggle({
    Name = "ğŸ›¡ï¸ ì•ˆí‹° ê·¸ë© í™œì„±í™”",
    CurrentValue = false,
    Callback = function(Value)
        antiGrabEnabled = Value
        if Value then
            setupAntiGrab()
            Rayfield:Notify({
                Title = "âœ… ì•ˆí‹° ê·¸ë© í™œì„±í™”",
                Content = "ì ‘ê·¼í•˜ëŠ” í”Œë ˆì´ì–´ë¡œë¶€í„° ë³´í˜¸í•©ë‹ˆë‹¤",
                Duration = 3
            })
        else
            Rayfield:Notify({
                Title = "â›” ì•ˆí‹° ê·¸ë© ë¹„í™œì„±í™”",
                Content = "ë³´í˜¸ ê¸°ëŠ¥ êº¼ì§",
                Duration = 2
            })
        end
    end
})

-- ì•ˆí‹° ê·¸ë© ëª¨ë“œ ì„ íƒ
local ModeDropdown = AntiGrabTab:CreateDropdown({
    Name = "ëŒ€ì‘ ëª¨ë“œ",
    Options = {"í…”ë ˆí¬íŠ¸", "ë„‰ë°±", "íˆ¬ëª…í™”"},
    CurrentOption = {"í…”ë ˆí¬íŠ¸"},
    Callback = function(Option)
        antiGrabMode = Option[1]
    end
})

-- ê°ì§€ ê±°ë¦¬ ìŠ¬ë¼ì´ë”
local DistanceSlider = AntiGrabTab:CreateSlider({
    Name = "ê°ì§€ ê±°ë¦¬",
    Range = {5, 30},
    Increment = 1,
    Suffix = "ìŠ¤í„°ë“œ",
    CurrentValue = 10,
    Callback = function(Value)
        antiGrabDistance = Value
    end
})

-- ê°•ì œ ì°¨ë‹¨ ë²„íŠ¼
AntiGrabTab:CreateButton({
    Name = "ğŸš« í˜„ì¬ ì¡íŒ ê±° í’€ê¸°",
    Callback = function()
        local lp = game.Players.LocalPlayer
        if not lp.Character then return end
        
        -- ëª¨ë“  Constraint ì œê±°
        for _, constraint in ipairs(lp.Character:GetDescendants()) do
            if constraint:IsA("Constraint") or constraint:IsA("JointInstance") then
                constraint:Destroy()
            end
        end
        
        -- Welds ì œê±°
        for _, weld in ipairs(lp.Character:GetDescendants()) do
            if weld:IsA("Weld") or weld:IsA("Snap") or weld:IsA("Motor6D") then
                if weld.Part0 and weld.Part1 then
                    if weld.Part0.Parent ~= lp.Character or weld.Part1.Parent ~= lp.Character then
                        weld:Destroy()
                    end
                end
            end
        end
        
        Rayfield:Notify({
            Title = "âœ… êµ¬ì† í•´ì œ",
            Content = "ëª¨ë“  ê·¸ë©/ì¡ê¸° í•´ì œë¨",
            Duration = 2
        })
    end
})

-------------------------------------------------------------
-- [2] ë°˜ì§ì´ëŠ” ë¬¼ê±´ ì°¾ê¸° (Shiny Objects)
-------------------------------------------------------------
local ShinySection = ShinyTab:CreateSection("âœ¨ ë°˜ì§ì´ íƒì§€")

local scanningShiny = false

local function isShinyObject(obj)
    if not obj:IsA("BasePart") then return false end
    
    -- Material ì²´í¬
    local shinyMaterials = {
        [Enum.Material.Neon] = true,
        [Enum.Material.DiamondPlate] = true,
        [Enum.Material.Foil] = true,
        [Enum.Material.Glass] = true,
        [Enum.Material.Glacier] = true
    }
    
    if shinyMaterials[obj.Material] then return true end
    
    -- Reflectance ì²´í¬ (ë°˜ì‚¬ìœ¨)
    if obj.Reflectance > 0.3 then return true end
    
    -- ë¹› ì²´í¬
    if obj:FindFirstChildOfClass("PointLight") or 
       obj:FindFirstChildOfClass("SurfaceLight") then
        return true
    end
    
    return false
end

local function scanForShiny()
    local found = {}
    
    for _, obj in ipairs(workspace:GetDescendants()) do
        if isShinyObject(obj) then
            table.insert(found, obj)
            
            -- í•˜ì´ë¼ì´íŠ¸ í‘œì‹œ
            local highlight = Instance.new("Highlight")
            highlight.Parent = obj
            highlight.Adornee = obj
            highlight.FillColor = Color3.fromRGB(255, 215, 0)
            highlight.FillTransparency = 0.3
            highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
            
            game:GetService("Debris"):AddItem(highlight, 5)
        end
    end
    
    return found
end

ShinyTab:CreateButton({
    Name = "ğŸ” ë°˜ì§ì´ ìŠ¤ìº”",
    Callback = function()
        local results = scanForShiny()
        Rayfield:Notify({
            Title = "ìŠ¤ìº” ì™„ë£Œ",
            Content = "ë°œê²¬ëœ ë°˜ì§ì´: " .. #results .. "ê°œ",
            Duration = 3
        })
    end
})

ShinyTab:CreateToggle({
    Name = "ğŸ”„ ìë™ ìŠ¤ìº”",
    CurrentValue = false,
    Callback = function(Value)
        scanningShiny = Value
        
        if Value then
            spawn(function()
                while scanningShiny do
                    scanForShiny()
                    task.wait(10)
                end
            end)
        end
    end
})

-------------------------------------------------------------
-- [3] ì‚¬ëŒ ë‚ ë¦¬ê¸° (Fling)
-------------------------------------------------------------
local FlingSection = FlingTab:CreateSection("ğŸ‘¥ í”Œë§")

local flingActive = false
local flingTargets = {}
local flingPower = 100

local function getPlayers()
    local list = {}
    for _, p in ipairs(game.Players:GetPlayers()) do
        if p ~= game.Players.LocalPlayer then
            table.insert(list, p.Name)
        end
    end
    return list
end

local TargetDropdown = FlingTab:CreateDropdown({
    Name = "í”Œë§ ëŒ€ìƒ",
    Options = getPlayers(),
    CurrentOption = {""},
    MultipleOptions = true,
    Callback = function(selected)
        flingTargets = selected
    end
})

FlingTab:CreateButton({
    Name = "ğŸ”„ ëŒ€ìƒ ìƒˆë¡œê³ ì¹¨",
    Callback = function()
        TargetDropdown:Set(getPlayers())
    end
})

local PowerSlider = FlingTab:CreateSlider({
    Name = "í”Œë§ íŒŒì›Œ",
    Range = {10, 500},
    Increment = 10,
    Suffix = "í˜",
    CurrentValue = 100,
    Callback = function(value)
        flingPower = value
    end
})

FlingTab:CreateToggle({
    Name = "âš¡ í”Œë§ í™œì„±í™”",
    CurrentValue = false,
    Callback = function(value)
        flingActive = value
        
        if value then
            local lp = game.Players.LocalPlayer
            if not lp.Character then return end
            
            spawn(function()
                while flingActive do
                    task.wait(0.1)
                    
                    if #flingTargets == 0 then
                        -- ëª¨ë“  ê·¼ì²˜ í”Œë ˆì´ì–´ í”Œë§
                        for _, player in ipairs(game.Players:GetPlayers()) do
                            if player ~= lp and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                                local dist = (lp.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                                if dist < 30 then
                                    firetouchinterest(lp.Character.HumanoidRootPart, player.Character.HumanoidRootPart, 0)
                                    task.wait(0.02)
                                    firetouchinterest(lp.Character.HumanoidRootPart, player.Character.HumanoidRootPart, 1)
                                end
                            end
                        end
                    else
                        -- ì„ íƒëœ í”Œë ˆì´ì–´ë§Œ í”Œë§
                        for _, targetName in ipairs(flingTargets) do
                            local player = game.Players:FindFirstChild(targetName)
                            if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                                firetouchinterest(lp.Character.HumanoidRootPart, player.Character.HumanoidRootPart, 0)
                                task.wait(0.02)
                                firetouchinterest(lp.Character.HumanoidRootPart, player.Character.HumanoidRootPart, 1)
                            end
                        end
                    end
                end
            end)
        end
    end
})

-- UI í† ê¸€ í‚¤ ì•ˆë‚´
Rayfield:Notify({
    Title = "ğŸ”’ ë¡œë“œ ì™„ë£Œ",
    Content = "K í‚¤ë¡œ UI í† ê¸€ | ì•ˆí‹° ê·¸ë© ê¸°ë³¸ í™œì„±í™”",
    Duration = 5
})
